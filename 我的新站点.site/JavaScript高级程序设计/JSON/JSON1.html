<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<script type="text/javascript" src="../../js/jquery-1.8.2.min.js"></script>
<script type="text/javascript">


/*构造函数*/
function Person(){
  this.name='helln';
  this.love='music';
  this.sayMe=function(){
    console.log(this.name);
  }
}

Person.prototype.eat='apple';

function Student(){
  this.course='softwear';
  this.grade='two';
  this.didiao=function(){
    console.log("grade====="+this.grade)
  }
}


Student.prototype=new Person();
Student.prototype.constructor=Student;
Student.prototype.stu=function(){
  console.log("student=="+this.grade);
}

function test1(){
   console.log('--------------------------简单对象------------------------------------')
   var obj={
		 name:"helln",
		 age:20
    };
   var objText=JSON.stringify(obj);//将javascript对象转成json，一般用于向服务器发送数据时传输json格式的数据

   console.log(objText);//{"name":"helln","age":20}
   console.log(typeof objText);//string


   console.log('--------------------------传入实例对象------------------------------------')
   //传入实例对象会怎样呢 
   var stu=new Student();
   stu.sayMe();//helln
   stu.name='Tom';
   stu.sayMe()//tom

   /*除了实例的原型添加的属性外(对象中的方法不会被JSON.stringify转换到json串结果中)，实例的属性是会被转换成json串的。*/
   var instanceStr=JSON.stringify(stu);
   console.log(stu);        //{ course: "softwear", grade: "two", didiao: Student/this.didiao(), name: "Tom" }
   console.log(instanceStr);//{"course":"softwear","grade":"two","name":"Tom"}

   console.log('--------------------------传入实例对象 formdata------------------------------------')
  //所以把formdata的实例传入JSON.stringify()中是没有结果的，实例的方法都在formdata的原型中
  var formdata = new FormData();
  formdata.append("name", "呵呵");
  formdata.append("url", "http://www.baidu.com/");

  console.log(JSON.stringify(formdata));//{}
}


function test11(){
    var obj={
		 name:"helln",
		 age:20
     };
   var objText=JSON.stringify(obj);//将javascript对象转成json，一般用于向服务器发送数据时传输json格式的数据
   
   //方法：用JSON.parse()  参数要传入json字符串，不能这样传入对象奥-->JSON.parse({"name":"helln"})

   var jsonObject=JSON.parse(objText);
   console.log(jsonObject);        //将json字符串解析成javascript对象，以便可以很方便的操作对象数据
   console.log(typeof jsonObject);  
	
   //函数eval()具体是怎么用的呢？
   var json1={"name":"hell","age":10};
   console.log(eval("json1"));
}

//将json的字符串解析成json数据格式的两种方式
function test2(){
  
   console.log(eval("{}"));//undefined   ？？？？？？？？？？？？？
   console.log(eval("({})"));//object{}
  console.log(eval("({\"name\":1})"));
  
  var json='{"name":"CJ","age":18}';
  data =(new Function("","return "+json))(); //???????
  console.log(data)
}


function test3(){
    var obj={
	    "上海":["上海社保","上海公积金"],
		"北京":["北京社保","北京公积金"]
	};
	console.log(obj["上海"]);
	
	for(var i in obj){
	   console.log("key:"+i+"  value:"+obj[i]);
	}
	
}

function test4(){
  var objArray=[
  { city:{name:"上海",value:"shagnhai"},
    typeAry:[
	      {name:"上海社保",value:"shagnhaishebao"},
		  {name:"上海公积金",value:"sahgnhaigongjijin"}
		  ]
   },
  {city:{name:"北京",value:"beijing"},
   typeAry:[
        {name:"北京社保",value:"beijingshebao"},
		{name:"北京公积金",value:"beijinggongjijin"}
		]
  }];
}

function test5(){
  //对象
  var ary=[
    {name:"a"},
	  {
      name:"b",
      age:undefined,
      sayhi:function(){

        console.log("hi");
      }
    }
  ];
  
  var json=JSON.stringify(ary);
  var jsonToObj=JSON.parse(json);
  console.log(json);//[{"name":"a"},{"name":"b"}]
  console.log(jsonToObj)
  
  
}

function toJSONTest(){
  var book={
    title:"三生三世十里桃花",
    authors:"唐七公子",
    toJSON:function(){

      return this.title;
    }
   }
    var json=JSON.stringify(book);
    console.log(json);//"三生三世十里桃花"

   /*可以让toJSON返回任何值,这个对象序列化后获取的是toJSON()返回的值，而不是对象本身序列完后的结果
     可以用toJSON()方法删除序列化结果对象中嵌套的某些对象，只要返回undefined即可*/
   var fbook={
        title:"三生三世",
        authors:"唐七公子",
        price:null  /*序列完的json字符串支持null的*/

   }
   var book1={
        title:"三生三世十里桃花",
        authors:"唐七公子",
        toJSON:function(){

          return undefined;
        }

   }

   fbook.smallBook=book1;

   var bookJson=JSON.stringify(fbook);
   console.log(bookJson);//{"title":"三生三世","authors":"唐七公子","price":null}

}

function parseTest(){
    var book={
        title:"三生三世",
        authors:"唐七公子",
        releaseDate:new Date(2011,11,1)  

   }

   var jsonStr=JSON.stringify(book);
   console.log(jsonStr);

   var simpleParse=JSON.parse(jsonStr);
   console.log(simpleParse);

   var handelParse=JSON.parse(jsonStr,function(key,value){
      if(key=="releaseDate"){

        return new Date(value);
      }else{

        return value;
      }

   });

   console.log(handelParse);
   console.log(handelParse.releaseDate.getFullYear());/*正是因为releaseDate用parse()方法的第二个参数-函数处理后，由字符串转为了Date对象，此处才可以直接调用getFullYear()方法呢*/
}

function xieTest(){

  var obj={
    name:'xiaoxin',
    age:10
  }


  var a=JSON.stringify(obj);
  console.log(a);

  var b=JSON.stringify(a);
  console.log(b)


  var c=JSON.parse(JSON.stringify(JSON.stringify(b)))
  console.log(JSON.parse(c))

   
}

/*单个值也可以用JSON方法处理，stringify()方法统一转为字符串，parse()方法解析为变量值原来的类型*/
function testNormal(){
  var num=100;
  var rlt=JSON.stringify(100);
  console.log(rlt); //100 typeof rlt =string

  var plt=JSON.parse(rlt)
  console.log(typeof plt)//100 typeof rlt=number


  sessionStorage.setItem('age',100);
  var slt=sessionStorage.getItem('age');

  console.log(typeof slt)//string
}
</script>
</head>

<body>
<input type="button"  name="d1" id="d1" value="将一个对象转换成json字符串" onclick="test1()"/></br>
<input type="button"  name="d1" id="d1" value="讲一个json字符串转换为对象" onclick="test11()"/></br>
<input type="button"  name="d1" id="d1" value="测试eval" onclick="test2()"/></br>

<input type="button"   id="d2" value="当key为数字或字符时的Object怎么获取key的值" onclick="test3()"/></br>

<input type="button"   id="d2" value="hehe" onclick="test4()"/></br>

<input type="button"    value="对象转json串时忽略undefined和函数" onclick="test5()"/></br>

<h3>------------------------对象自定义序列化json字符串方法：toJSON()------------------------</h3>
<input type="button"    value="对象自定义序列方法" onclick="toJSONTest()"/></br>


<h3>---------------解析选项：JSON.parse()方法也可以传入第二个参数-一个函数------------------</h3>
<input type="button"    value="parse解析定义" onclick="parseTest()"/></br>


<h3>---------------斜杠------------------</h3>
<input type="button"    value="ajax返回的数据带有斜杠的问题" onclick="xieTest()"/></br>

<button onclick="testNormal()">普通值通过JSON对象的方法进行处理</button>
</body>
</html>
