<!doctype html>
<html class="no-js">
<head>
<meta charset="gb2312">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Hello Amaze UI</title>

<!-- Set render engine for 360 browser -->
<meta name="renderer" content="webkit">

<!-- No Baidu Siteapp-->
<meta http-equiv="Cache-Control" content="no-siteapp"/>
<link rel="icon" type="image/png" href="assets/i/favicon.png">

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Amaze UI"/>
<link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="assets/i/app-icon72x72@2x.png">
<meta name="msapplication-TileColor" content="#0e90d2">
<link rel="stylesheet" href="assets/css/amazeui.min.css">
<link rel="stylesheet" href="assets/css/app.css">
<!--json数据-->
<script type="text/javascript"  src="assets/js/tongxunlu.js"></script>
<!--将汉字转为拼音的js-->
<script type="text/javascript"  src="assets/js/pin.js"></script>
<script src=" assets/js/jquery.min.js"></script> 
<script src=" assets/js/int.web.js"></script> 
<script src="assets/js/amazeui.js"></script> 
<script src="assets/js/int.pageajax.js"></script>
<script src="assets/js/jquery.transit.js"></script> 
<script src="assets/js/int.com.js" type="text/javascript"></script>
<script src="assets/js/int.datecur.js" type="text/javascript"></script>
<script type="text/javascript"  src="assets/js/jquery.dialog.js"></script>
<script type="text/javascript"  src="assets/js/jquery.bgiframe.min.js"></script>

</head>
<body>
<header class="am-header am-header-default am-no-layout" data-am-widget="header">
  <div class="am-titlebar-left"> <a class="bak_ico" title="????" href="javascript:history.go(-1)"><em></em></a> </div>
  <h1 class="am-header-title">???</h1>
  <div class="am-titlebar-right"><!-- <a title="" class="select_ico"><em class="tongxunlu-ico"></em></a> --></div>
</header>
<div class="select_list none">
          <ul class="tab tab_menu">
            <li class="cur">按部门</li>
            <li>按职位</li>
          </ul>
          <div class="cont tab_cont_view">
            <div>
              <ul class="menu-list-item">
                <li class="subli">
                	<a>分公司</a>
                    <ul class="gsidlist">
                        <li data-gsid="5"><a>研发部</a></li>
                        <li data-gsid="5"><a>研发部</a></li>
                        <li data-gsid="5"><a>研发部</a></li>
                    </ul>
                </li>
                <li class="subli">
                	<a>分公司</a>
                <ul class="gsidlist">
                	<li data-gsid="5"><a>研发部</a></li>
                    <li data-gsid="5"><a>研发部</a></li>
                    <li data-gsid="5"><a>研发部</a></li>
                </ul>
                </li>
                <li data-gsid="5"><a>研发部</a></li>
                <li data-gsid="5"><a>研发部</a></li>
              </ul>
            </div>
            <div class="none">
              <ul class="menu-list-item">
                <li class="subli">
                	<a>按职位</a>
                    <ul class="gsidlist">
                        <li data-gsid="5"><a>研发部</a></li>
                        <li data-gsid="5"><a>研发部</a></li>
                        <li data-gsid="5"><a>研发部</a></li>
                    </ul>
                </li>
                <li class="subli">
                	<a>分公司</a>
                <ul class="gsidlist">
                	<li data-gsid="5"><a>研发部</a></li>
                    <li data-gsid="5"><a>研发部</a></li>
                    <li data-gsid="5"><a>研发部</a></li>
                </ul>
                </li>
                <li data-gsid="5"><a>研发部</a></li>
                <li data-gsid="5"><a>研发部</a></li>
              </ul>
            </div>
          </div>
          <div class="btns"><a class="am-btn am-btn-secondary am-radius">重置</a> <a class="am-btn am-btn-primary am-radius">确定</a></div>
        </div>
        <div class="page-header am-cf">
        <div class="am-g" data-posturl="sosuo.html">
          <div class="search-main">
          <div class="search_ico"><input type="text" id="searchkeyword" class="search-keyword" placeholder="搜索" value="" onKeyUp="handle(this)"><a class="clearico"></a>
          </div>
           <a class="page-back none">取消</a><a style="display: none" class="touchable">搜索</a> </div>
         </div>
      </div>
<div class="city_list"> 
  <div class="city-wrapper" id="clist">
   <!--  <h3 class="cityhli city-key-A">A</h3>
    <ul id="A">
    </ul>
    <h3 class="cityhli city-key-B">B</h3>
    <ul id="B">
     
    </ul>
    <h3 class="cityhli city-key-C">C</h3>
    <ul id="C">
      
    </ul>
    <h3 class="cityhli city-key-D">D</h3>
    <ul id="D">
      
    </ul>
    <h3 class="cityhli city-key-E">E</h3>
    <ul id="E">
      
    </ul>
    <h3 class="cityhli city-key-F">F</h3>
    <ul id="F">
     
    </ul>
    <h3 class="cityhli city-key-G">G</h3>
    <ul id="G">
      
    </ul>
    <h3 class="cityhli city-key-H">H</h3>
    <ul id="H">
      
    </ul>
    <h3 class="cityhli city-key-J">J</h3>
    <ul id="J">
      
    </ul>
    <h3 class="cityhli city-key-K">K</h3>
    <ul id="K">
     
    </ul>
    <h3 class="cityhli city-key-L">L</h3>
    <ul id="L">
      
    </ul>
    <h3 class="cityhli city-key-M">M</h3>
    <ul id="M">
     
    </ul>
    <h3 class="cityhli city-key-N">N</h3>
    <ul id="N">
     
    </ul>
	 <h3 class="cityhli city-key-O">O</h3>
    <ul id="O">
     
    </ul>
    <h3 class="cityhli city-key-P">P</h3>
    <ul id="P">
     
    </ul>
    <h3 class="cityhli city-key-Q">Q</h3>
    <ul id="Q">
      
    </ul>
    <h3 class="cityhli city-key-R">R</h3>
    <ul id="R">
      
    </ul>
    <h3 class="cityhli city-key-S">S</h3>
    <ul id="S">
      
    </ul>
    <h3 class="cityhli city-key-T">T</h3>
    <ul id="T">
      
    </ul>
	 <h3 class="cityhli city-key-U">U</h3>
    <ul id="U">
      
    </ul>
	 <h3 class="cityhli city-key-V">V</h3>
    <ul id="V">
      
    </ul>
    <h3 class="cityhli city-key-W">W</h3>
    <ul id="W">
      
    </ul>
    <h3 class="cityhli city-key-X">X</h3>
    <ul id="X">
      
    </ul>
    <h3 class="cityhli city-key-Y">Y</h3>
    <ul id="Y">
      
    </ul>
    <h3 class="cityhli city-key-Z">Z</h3>
    <ul id="Z">
    </ul> -->
  </div>
  <ul class="city-nav phonenav" id="clistByKey">
  <li data-key="A">A</li><li data-key="B">B</li><li data-key="C">C</li><li data-key="D">D</li><li data-key="E">E</li><li data-key="F">F</li><li data-key="G">G</li><li data-key="H">H</li><li data-key="J">J</li><li data-key="K">K</li><li data-key="L">L</li><li data-key="M">M</li><li data-key="N">N</li><li data-key="P">P</li><li data-key="Q">Q</li><li data-key="R">R</li><li data-key="S">S</li><li data-key="T">T</li><li data-key="W">W</li><li data-key="X">X</li><li data-key="Y">Y</li><li><a href="#Z">Z</a></li>
  </ul>
</div>
  <ul class="city-nav phonenav" id="clistByKey">
  <li data-key="A">A</li><li data-key="B">B</li><li data-key="C">C</li><li data-key="D">D</li><li data-key="E">E</li><li data-key="F">F</li><li data-key="G">G</li><li data-key="H">H</li><li data-key="J">J</li><li data-key="K">K</li><li data-key="L">L</li><li data-key="M">M</li><li data-key="N">N</li><li data-key="P">P</li><li data-key="Q">Q</li><li data-key="R">R</li><li data-key="S">S</li><li data-key="T">T</li><li data-key="W">W</li><li data-key="X">X</li><li data-key="Y">Y</li><li><a href="#Z">Z</a></li>
  </ul>
</div>
<!-- ????????? -->
<form action="${ctx }/webApp/tongxunluDetail" method="post" id="form2">
  <input type="hidden" name="tusername" id="tusername">
  <input type="hidden" name="tdept" id="tdept">
  <input type="hidden" name="tposition" id="tposition">
  <input type="hidden" name="tmobile" id="tmobile">
  <input type="hidden" name="tphone" id="tphone">
  <input type="hidden" name="temail" id="temail">
</form>

<script>
 var zimuArray=[ 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I',  
	             'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'  
	              ]; 
	              
   
  
  //???????????????
 // var nameArray=null;
  
$(function() {
          //???л
	   $(".page-back").click(function(){
			$(".page-back").hide();
			$("#searchkeyword").parent().removeClass("cur");
			 
			if(tempObject){
				 
				showTongxunlu(tempObject);
			}
			
		});
  
           /**
		   	 调用通讯录接?
		  **/
		  // $.getJSON("${ctx}/hrhelper-platform/contantList", function (data1) {
		         
		     //   if(data1.errorMessage!==undefined){
	           //   console.log("错误消息=="+data.errorMessage);
	            //  return;
	           //  }
		       //  tempObject=data1;
		         showTongxunlu(tempObject);
		       // });
});


//加载所有通讯录数据

	function showTongxunlu(data1) {
		//nameArray=new Array();
		var resultHtml = "";
		//var dataKey="";
	 
			 
		var reclen = data1.rec.length;
		var rec = data1.rec;

		for (var i = 0; i < reclen; i++) {

			 
				var recKey=rec[i].key;
				var recValue = rec[i].value;
				var len = recValue.length;
				
				var ctTitle = '<h3 class="cityhli city-key-'+recKey+'">' + recKey + '</h3>';
				 
				var liStr = "";
				for (var x = 0; x < len; x++) {

					//$("#"+recKey).append("<li onClick='updateClass("+result[x].USER_ID+")' data-name="+result[x].CNAME+"  data-id="+result[x].USER_ID+">"+result[x].CNAME+"</li>");
					liStr += '<li onClick="updateClass('
						   +"\'" + recValue[x].USER_ID +"\'" + ','+"\'"+recValue[x].CNAME+"\'"+','+"\'"+recValue[x].DEPT_NAME+"\'"+','+"\'"+recValue[x].position+"\'"+','+"\'"
						   +recValue[x].mobile+"\'"+','+"\'"+recValue[x].phone+"\'"+','+"\'"+recValue[x].email+"\'"+')" data-name='
							+ recValue[x].CNAME + '  data-id='
							+ recValue[x].USER_ID + '>' +'<a href='+recValue[x].CNAME+'>'+ recValue[x].CNAME+'</a>'
							+ '</li>';
					//nameArray.push(recValue[x].CNAME);
				}
				resultHtml += ctTitle + "<ul>" + liStr + "</ul>";
			 
		}

		 
		$("#clist").html(resultHtml);
		//$("#clistByKey").html(dataKey);

	}
	
	/**
	 处理模糊查询
	 **/
	function handle(which) {
	
	    
		
		var  chars= which.value;//输入?
		var  charsLen= chars.length;//输入值的长度
	      
		if(chars!=""){
			$(".page-back").show();
			$("#searchkeyword").parent().addClass("cur");
		}else{
			$(".page-back").hide();
			$("#searchkeyword").parent().removeClass("cur");
		}
	
		if ($.trim(chars) !== "") {//输入值为不为空的情况
		
			//判断字母or汉字
			var isZ = checkIsZimu(chars);//字母
			var isC = checkIsChinese(chars);//汉字
			

			//输入字母
			if (isZ) {
				
				//单个字母
				if ( charsLen == 1) {
					 
					handlezimu1(chars);
				}
				
				//多个字母(1.每个汉字拼音的首字母组合  2.汉字的部分全拼)
				if ( charsLen > 1) {
					 
					handlezimu2(chars, "dzm");

				}

			}

			//输入汉字
			if (isC) {
				//console.log("输入的是汉字====================");
				handlezimu2(chars, "ll");
			}

		} else {//显示全部数据
			showTongxunlu(tempObject);

		}

	}

	//单个字母处理
	function handlezimu1(chars) {

		 
	   //根据输入的单个个字母查找与之匹配的首字母的数据
		var upperChars=chars.toUpperCase();
		var reclen = tempObject.rec.length;
		var rec = tempObject.rec;

		for (var i = 0; i < reclen; i++) {

				var contactsKey=rec[i].key;
				var contactsAry = rec[i].value;
				var contactsLen = contactsAry.length;
				
				if (contactsKey === upperChars) {
					
					$("#clist").html("");//清空
					var tempHtml = "";
					
					for (var x = 0; x < contactsLen; x++) {
					
						var name = contactsAry[x].CNAME;
						var first = name.substr(0, 1);
						var end = name.substr(1);
						var hfe = '<span style="color:#00FF00">' + first
								+ '</span>' + end;
								
						tempHtml += '<li onClick="updateClass('
							 +"\'" + contactsAry[x].USER_ID +"\'" + ','+"\'"+contactsAry[x].CNAME+"\'"+','+"\'"+contactsAry[x].DEPT_NAME+"\'"+','+"\'"+contactsAry[x].position+"\'"+','
							 +"\'"+contactsAry[x].mobile+"\'"+','+"\'"+contactsAry[x].phone+"\'"+','+"\'"+contactsAry[x].email+"\'"+ ')" data-name='
								+ contactsAry[x].CNAME + '  data-id='
								+ contactsAry[x].USER_ID + '>' + hfe + '</li>';
								
					}
					$("#clist").html('<ul>' + tempHtml + '</ul>');
				 
					break;
				}

			 
		}

		 
	}
	
	//输入多个字母时处?
	function handlezimu2(chars, zh) {

		 
		if (zh === "dzm") {
			chars = chars.toUpperCase();//输入的值为字母时转成大?
		}
		 
		$("#clist").html("");//清空
		var tempHtml = "";
		var reclen = tempObject.rec.length;
		var rec = tempObject.rec;

		for (var i = 0; i < reclen; i++) {

 
			var contactsKey=rec[i].key;
			var contactsAry = rec[i].value;
			var contactsLen = contactsAry.length;
			

			for (var x = 0; x < contactsLen; x++) {

				var tempName = contactsAry[x].CNAME;//真实姓名

				var singleGroup = tempName; //汉字拼音首字母组合
				var pinyinTempName;			//汉字姓名全拼
				

				//根据nameArray中的每个名字为字母或汉字的不同，处理不同
				if (checkIsZimu(tempName)) {
					//如果nameArray中的名字为英?包括英文中间带空格的)，不需要转拼音
					pinyinTempName = tempName.toUpperCase();
					//果nameArray中的名字为英?包括英文中间带空格的)，不需要转成单个汉字的首字母组合
					singleGroup = "nosingleGroup";
				}else{
				
				   if (zh === "dzm") {
					singleGroup = subName(tempName);   //处理成姓名首字母组合
				   } 
				   
				   pinyinTempName = codefans_net_CC2PY(tempName).toUpperCase();//姓名转成全拼
				   
				}

				//按单个汉字的拼音匹配 liuxue 匹配 刘雪     (pinyinTempName).indexOf(chars)!=-1
				if (zh === "dzm" && replaceIndexof(pinyinTempName, chars)) {
				    
					var colorName = quanpin(chars, tempName);
					 
					if (colorName !== undefined) {
						var end = "";
						if (colorName !== tempName) {
							end = tempName.substring(colorName.length);
						}
						var hfe = '<span style="color:#00FF00">' + colorName
								+ '</span>' + end;
						tempHtml += '<li onClick="updateClass('  + x  + ','+"'"+contactsAry[x].CNAME+"'"+','+"'"
								+contactsAry[x].DEPT_NAME+"'"+','+"'"+contactsAry[x].position+"'"+','+"'"+contactsAry[x].mobile+"'"+','+"'"+contactsAry[x].phone+"'"
								+','+"'"+contactsAry[x].email+"'"+')"  data-name=' + tempName + '  data-id=' + x
								+ '>' + hfe + '</li>';
					}

				}

				//按照汉字或者汉字拼音的首字?  singleGroup.indexOf(chars) != -1    replaceIndexof(singleGroup,chars)
				if (singleGroup !== "nosingleGroup"&& replaceIndexof(singleGroup, chars)) {
				     
					var first = tempName.substr(0, chars.length);
					var end = tempName.substring(first.length);
					var hfe = '<span style="color:#00FF00">' + first
							+ '</span>' + end;
					tempHtml += '<li onClick="updateClass('+x + ','+"'"+contactsAry[x].CNAME+"'"+','+"'"+contactsAry[x].DEPT_NAME
							+"'"+','+"'"+contactsAry[x].position+"'"+','+"'"+contactsAry[x].mobile+"'"+','+"'"+contactsAry[x].phone+"'"+','+"'"
							+contactsAry[x].email+"'"+ ')" data-name=' + tempName + '  data-id=' + x
							+ '>' + hfe + '</li>';

				}
			}

		}

		$("#clist").html('<ul>' + tempHtml + '</ul>');

	}

	
	/**
	    正则 判断是否是汉字
	 **/
	function checkIsChinese(str) {
	
	    var pattern = /^([\u4E00-\u9FA5]|[\uFE30-\uFFA0])*$/gi;
		
		//如果值为空，通过校验
		if (str == "") {
			return false;
		}
		
		//if (pattern.test(str)) {
//			return true;
//		} else {
//			return false;
//		}

		return pattern.test(str);

	}
	/**
	      正则 判断是否是字母
	 **/
	function checkIsZimu(str) {
	
	    var pattern = /^[a-zA-Z ]*$/gi;
		
		//如果值为空，通过校验
		if (str === " " || str === "") {
			return false;
		}
		
	//	if (pattern.test(str)) {
//			return true;
//		} else {
//			return false;
//		}
		return pattern.test(str);

	}
	//循环截取单个字符，并转换成拼音格式的,返回姓名的单个汉字的拼音的首字母的字符串
	function subName(name) {
		var zmArray = "";
		var nl = name.length;
		if (nl > 0) {
			for (var i = 0; i < nl; i++) {
				var tempName = name.substr(i, 1);
				var tempSingle = codefans_net_CC2PY(tempName).toUpperCase();
				zmArray += tempSingle.substr(0, 1);
			}
			return zmArray;
		}
	}
	//输入全拼拼音时顺序匹?liuxue  匹配 刘雪   or  liux 匹配 刘雪
	function quanpin(inputVal, tempName) {
		var tempNameLength = tempName.length;
		
		//根据真实名字是英文还是中文判断操作方法，英文直接截取，中文需要根据单个汉字逐个循环后拼成的拼音全拼操作
		if(checkIsZimu(tempName)){
		    var rname=tempName.substring(0,inputVal.length);
			return rname;
		}
		
		
		for (var i = 0; i < tempNameLength; i++) {
			var subSingleName = tempName.substr(0, i + 1);
			
			var subSingleNmmeUpper=codefans_net_CC2PY(subSingleName).toUpperCase();
			
			if (subSingleNmmeUpper=== inputVal) {
			
				var resultName = subSingleName;
				break;
				
			}else{
			   var temp= subSingleNmmeUpper.substr(0,inputVal.length);
			   
			   if(temp==inputVal){
			      var resultName = subSingleName;
				  break; 
			   }
			}
		}
		
		 
		
		return resultName;
	}

	//indexOf匹配后重叠字符会出错，替代方法如下
	/*
	   tempName:处理成全拼的姓名
	   inputVal:输入的全拼字母
	*/
	function replaceIndexof(tempName, inputVal) {

		var c = tempName.substr(0, inputVal.length);
		 
		if (inputVal === c) {
			return true;
		}
		return false;
	}
	
	//点击选项时的样式,显示通讯录详情
function updateClass(index,name,dept,position,mobile,phone,email){
	
	//蓝色勾样?
	//$('.city-wrapper ul li').removeAttr('class');
	//$('[data-id='+index+']').prop('class','cur');
	
	if(name!=="undefined"){
		$("#tusername").val(name);
	}
	if(dept!=="undefined"){
		$("#tdept").val(dept);
	}
	if(position!=="undefined"){
		$("#tposition").val(position);
	}
	if(mobile!=="undefined"){
		$("#tmobile").val(mobile);
	}
	if(phone!=="undefined"){
		$("#tphone").val(phone);
	}
	if(email!=="undefined"){
		$("#temail").val(email);
	}

	$("#form2").submit();
}
</script> 
</body>
</html>
