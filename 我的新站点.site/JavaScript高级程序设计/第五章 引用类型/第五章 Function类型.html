<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<script type="text/javascript" src="../../js/jquery-1.8.2.min.js"></script>
<script type="text/javascript">
 function num(num1,num2){
   return num1+num2;
 }
 var num=function(num1,num2){
   return num1+num2;
 }
 var num1=num;
 num=null;//销毁num指针
 
 //构造函数
 function Person(name){
     this.name=name;
 }
 

$(function(){

/*
  对象和函数
  Object和Function是两种引用类型奥~
*/
$("#f1").on("click",function(){
   //console.log(num(1,2));
    console.log(num1(1,2));//3
   
    /*typeof分别检测实例和函数，得到的结果：对象实例都是object类型的，而函数是function类型的
	  js中函数也是对象，但是函数有一些特殊的属性，因此归为function类型。
	*/
  
    //函数类型
	console.log("typeof num1: "+typeof num1);		//function
	
	//另一种创建函数的方式
	var num6=new Function("num1","num2","return num1+num2");
	console.log("typeof num6: "+typeof num6);//function  检测是Function类型哎
	
	//创建对象
	var strObj=new String("123");  //typeof strObj =object
    var obj=new Object();			//typeof obj =object
	
	//用构造函数创建对象
	var p1=new Person("Nichols");//typeof p1=object
	console.log("typeof p1: "+typeof p1);//object
	
	//执行第三种函数
	console.log(num6(2,2));//4
	 
    
  
})
//console.log(num2()); 会报错，原因是num2是函数表达式，还未被初始化
var num2=function(){
   return "hello world！";
}
 console.log(num2());
 console.log("调用函数num3()=="+num3());
  console.log("取函数指针，但不调用num3=="+num3);
 //函数声明
 function num3(){
   return "hello world1!";
 }
});

/*........................................................*/

function pf(n1,n2){
  var al=arguments.length;
  return al;
}

//递归
function factorial(num){
	if(num<=1){
		return num;
	}else{
	   return num*arguments.callee(num-1);
	}
}




function test1(){
   //函数参数个数arguments.length
   console.log(pf(1));//1
   console.log(pf(5,2));//2
   
   //测试递归
   var factorial2=factorial;
   console.log(factorial2(3));//6
   
   //测试this
   sayColor();//red this指向window
   
   sayColor.call(o);//blue this指向对象o
   

}
/*call()和apply()可以扩展函数赖以运行的作用域*/

function sayEng(num){
  return "hello "+num;
}

function callYy(n){
  //console.log(this);
   return sayEng.call(this,n);
}

function applyYy(n){
  //console.log(this);
   return sayEng.apply(this,arguments);
}

//this

window.color="red";
var o={color:"blue"};
function sayColor(){
  console.log(this);
  console.log(this.color);
}



function test2(a,b,c){
  // 函数的属性length-同函数的内部对象arguments的属性：arguments.length
  console.log(factorial.length);//1
  console.log(sayColor.length);//0
  
   sayColor.call(this);// red
   
   sayColor.call(o);//blue 在对象o的作用域调用函数sayColor，this当然指向对象o
   
   sayColor.apply(this);// red
   
   sayColor.apply(o);//blue
   
   /*jQuery的$.proxy方法可以替代js的call 来改变this的值奥*/
   var newSayColor=$.proxy(sayColor,window);
  newSayColor();//blue
  
  console.log(callYy("tom"));//hello tom  this指向全局对象window  因为鼠标地点击test2时，实在全局环境中运行哒
  console.log(applyYy("jack"));//hello jack
  
  
  console.log(arguments.callee.length);//   3  length可以获取函数的参数个数 
  
  
  
  
   
  
}

function sayCall(){
 
  console.log(this.color);
  console.log(this);
}

/*怎么this的结果都指向了window哎*/
function test22(){
   
   
    sayCall(null);
    sayCall(1);
    sayCall("hello");
    sayCall(true);
}

var value="apple";
var eat={
      value:"bread",
	  say:function(){
	    
		 
		 console.log(this.value);
	    
	  }
   };
   
 var drink={
      value:"milk",
	  say:function(){
	    
		 
		 console.log(this.value);
	    
	  }
   };
function test3(){
   
   eat.say();//bread
   
  /*改变函数的执行环境后 ，this指向drink*/
  var newSay= $.proxy(eat.say,drink);
  
  newSay();//milk
  
}

function test4(){
 /* var v="   ";
  var c=" ab  c";
  console.log(v.length);//3
  console.log(v=="");//false
  console.log($.trim(c));
   console.log($.trim(v).length);
   
   var vv="hello";
   var ss=vv.substr(1);
   var aa=vv.substring(1);
    console.log(ss);
	console.log(aa);
	*/
	
	var name="宋佳何";
	var nn=name.substr(name.indexOf("佳"),name.indexOf("佳"));
	var na=name.substr(name.indexOf("佳何"),"佳何".length);
	console.log(nn);
	console.log(na);
	
	var cc=name.replace("佳","h");
	console.log(cc);
}


$(function(){

	 /* $("#testcall").on("click",function(){
		  eat.say();
	  });*/
  
 
  
     /*$("#testcall").on("click",eat.say );*/  //测试call方法
	 
	 $("#testcall").on("click",$.proxy(eat.say,eat) );//bread

});

function test5(){
  var result="var vb=123;return vb;";
  var fn=new Function("obj",result);
  var rt=fn();
  console.log(rt);//123
}



 
</script>
</head>

<body>
<input type="button"  name="f1" id="f1" value="对象Object类型和函数Function类型"/></br>
<input type="button"   value="函数内部对象：arguments和this" onclick="test1()"/></br>
<input type="button"   value="函数的属性和方法" onclick="test2()"/></br>

<input type="button"   value="函数的属性和方法-call()" onclick="test22()"/></br>

<input type="button"   value="call()" onclick="test3()"/></br>

<input type="button"   value="测试call方法"     id="testcall"/></br>

<input type="button"   value="空字符串的长度"      onclick="test4()"/></br>

<input type="button"   value="不长使用的定义函数的方式"      onclick="test5()"/></br>

<input type="button"   value="字符串循环模板模拟"      onclick="test6()"/></br>

<div id="results">template..........</div>

<!--模板-->
<script type="text/html" id="user_tmpl">
   <ul>
     <% for ( var i=0; i< users.length;i++){ %>
	 <li><a href="<%=users[i].url%>"><%=users[i].name%></a></li>
	 <%}%>
   </ul>
</script>

<script>
  var results=$("#results")[0];
  var users=[
    {name:"byron","url":"localhost"},
	{name:"tom","url":"localhost"},
	{name:"jack","url":"localhost"}
  ];
  
  
  /*
  
  var p=[];
  with(obj){
  p.push('    <ul>      '); 
  for ( var i=0; i< users.length;i++){
  
	   p.push('   <li><a href="');
	   p.push(users[i].url);
	   p.push('">');
	   p.push(users[i].name);
	   p.push('</a></li>   ');
	   }
	   p.push('    </ul> ');
	   
	   }
	   return p.join('');
	   
   */
   
  //自己编写的模板渲染方法
  function templ(id,data){
     var html=$(id)[0].innerHTML;
	 console.log("html:"+html);
	 console.log("html.replace:"+html.replace(/[\r\n\t]/g," "));
	 
/* <ul>      <% for ( var i=0; i< users.length;i++){ %>   <li><a href="<%=users[i].url%>"><%=users[i].name%></a></li>   <%}%>    </ul> */
	 
	 console.log("html.replace.replace:"+html.replace(/[\r\n\t]/g," ") .replace(/<%=(.*?)%>/g,"');p.push($1);p.push('"));
/*

 <ul>      <% for ( var i=0; i< users.length;i++){ %>   <li><a href="');p.push(users[i].url);p.push('">');p.push(users[i].name);p.push('</a></li>   <%}%>    </ul> 

*/	

 console.log("html.replace.replace.replace:"+html.replace(/[\r\n\t]/g," ") .replace(/<%=(.*?)%>/g,"');p.push($1);p.push('").replace(/<%/g,"');"));
 /*<ul>      '); for ( var i=0; i< users.length;i++){ %>   <li><a href="');p.push(users[i].url);p.push('">');p.push(users[i].name);p.push('</a></li>   ');}%>    </ul> */
 
 
  console.log("html.replace.replace.replace:"+html.replace(/[\r\n\t]/g," ") .replace(/<%=(.*?)%>/g,"');p.push($1);p.push('").replace(/<%/g,"');").replace(/%>/g,"p.push('"));
  
 /*<ul>      '); for ( var i=0; i< users.length;i++){ p.push('   <li><a href="');p.push(users[i].url);p.push('">');p.push(users[i].name);p.push('</a></li>   ');}p.push('    </ul>*/ 
 
    var result="var p=[];with(obj){p.push('"
	 +html.replace(/[\r\n\t]/g," ")
	 .replace(/<%=(.*?)%>/g,"');p.push($1);p.push('")
	 .replace(/<%/g,"');")
	 .replace(/%>/g,"p.push('")
	 +"');}return p.join('');";
	 console.log(result);
	// debugger;
	 var fn=new Function("obj",result);
	 return fn(data);
  }
  
  function test6(){
     results.innerHTML=templ("#user_tmpl",users);
	
	 
  }
  
function test7(){
    var str="<a href='<%=users[i].url%>'>><%=users[i].name%></a>";
	var rstr1=str.replace(/<%=(.*?)%>/g,"p.push($1)");
	var rstr2=str.replace(/<%=(.*)%>/g,"p.push($1)");
	var rstr3=str.replace(/<%=(.*)?%>/g,"p.push($1)");
	console.log(rstr1);
	
	/*<a href='p.push(users[i].url)'>>p.push(users[i].name)</a>*/
	
	console.log(rstr2);
	/*<a href='p.push(users[i].url%>'>><%=users[i].name)</a>*/
	console.log(rstr3);
  }
</script>


<input type="button"   value="正则"      onclick="test7()"/></br>

</body>
</html>
